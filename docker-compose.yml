# =====================================================================================
# üê≥ DOCKER COMPOSE F√úR JAVASCRIPT PERSONEN-VERWALTUNG
# =====================================================================================
# Einfache Orchestrierung f√ºr OrbStack

services:
  # ===== HAUPTANWENDUNG =====
  personen-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: personen-verwaltung
    ports:
      - "8080:80"  # Host-Port:Container-Port
    restart: unless-stopped
    environment:
      - NGINX_HOST=localhost
      - NGINX_PORT=80
    volumes:
      # Entwicklung: Bind-Mount mit langem Syntax (Pfad enth√§lt ":")
      - type: bind
        source: /Users/gabriel/SWP-Web/code
        target: /usr/share/nginx/html/code
      - logs:/var/log/nginx  # Logs im Named Volume speichern
    networks:
      - personen-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "com.docker.compose.project=personen-verwaltung"
      - "com.docker.compose.service=personen-app"
      - "traefik.enable=true"
      - "traefik.http.routers.personen.rule=Host(`personen.localhost`)"
      - "traefik.http.services.personen.loadbalancer.server.port=80"

# ===== NETZWERK =====
networks:
  personen-network:
    driver: bridge
    name: personen-verwaltung-network

# ===== VOLUMES =====
volumes:
  logs:
    driver: local
    name: personen-verwaltung-logs

# =====================================================================================
# üöÄ VERWENDUNG MIT ORBSTACK:
# =====================================================================================
#
# 1. Container starten:
#    docker-compose up -d
#
# 2. Container stoppen:
#    docker-compose down
#
# 3. Logs anzeigen:
#    docker-compose logs -f
#
# 4. Container neu bauen:
#    docker-compose up --build -d
#
# 5. Status pr√ºfen:
#    docker-compose ps
#
# =====================================================================================
# üåê ZUGRIFF:
# =====================================================================================
# - Lokal: http://localhost:8080
# - Mit Traefik: http://personen.localhost (falls Traefik l√§uft)
#
# =====================================================================================
